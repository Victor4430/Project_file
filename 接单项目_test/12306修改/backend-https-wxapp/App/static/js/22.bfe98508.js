(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[22],{"7EZI":function(t,e,a){"use strict";var s=a("btDK"),r=a.n(s);r.a},NI1S:function(t,e,a){"use strict";var s=a("dUJr"),r=a.n(s);r.a},btDK:function(t,e,a){},dUJr:function(t,e,a){},iHD7:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},["未开始"==t.model.status?a("span",[t._v("\n        交易准备中......\n      ")]):"进行中"==t.model.status?a("span",[t._v("\n        交易进行中......\n      ")]):"已结束"==t.model.status?a("span",[t._v("\n        "+t._s("交易批次："+t.model.name)+"\n      ")]):t._e()]),t._v(" "),"未开始"==t.model.status?a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleAddSupRobot(2)}}},[t._v("\n        补充机器人\n      ")]),t._v(" "),a("Button",{attrs:{size:"small",type:"primary"},on:{click:function(e){e.preventDefault(),t.handleCommit(0,-1,1)}}},[t._v("\n        开始交易\n      ")])],1):t._e(),t._v(" "),"进行中"==t.model.status?a("Button",{attrs:{slot:"extra",size:"small",type:"primary"},on:{click:function(e){e.preventDefault(),t.handleCommit(1,-1,1)}},slot:"extra"},[t._v("\n      停止交易\n    ")]):t._e(),t._v(" "),"已结束"==t.model.status?a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleCommit(2,-1,3)}}},[t._v("\n        撮合数据\n      ")]),t._v(" "),a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleCommit(2,-1,2)}}},[t._v("\n        申报数据\n      ")]),t._v(" "),a("Button",{attrs:{size:"small",type:"primary"},on:{click:function(e){e.preventDefault(),t.handleCommit(2,-1,1)}}},[t._v("\n        出清结果\n      ")])],1):t._e(),t._v(" "),"未开始"==t.model.status?a("div",[a("Row",[a("Col",{attrs:{span:12}},[a("Card",[a("h3",{attrs:{slot:"title"},slot:"title"},[t._v("发电侧主体共"+t._s(t.model.m_pro_cp_num)+"家")]),t._v(" "),a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleReady(1)}}},[t._v("\n              已准备\n            ")])],1),t._v(" "),a("h4",[a("span",{staticStyle:{color:"Lime"}},[t._v("已加入"+t._s(t.sup_robots)+"个机器人，已进入"+t._s(t.sup_in)+"家，")]),a("span",{staticStyle:{color:"Tomato"}},[t._v("还有"+t._s(t.model.m_pro_cp_num-t.sup_in-t.sup_robots)+"家未进入")])]),t._v(" "),a("Card",[a("transition-group",{attrs:{name:"suplist",tag:"p"}},t._l(t.suplogitems,function(e,s){return a("div",{key:s,staticClass:"list-item"},[t._v("\n                "+t._s(e.content)+"\n              ")])}))],1)],1)],1),t._v(" "),a("Col",{attrs:{span:12}},[a("Card",[a("h3",{attrs:{slot:"title"},slot:"title"},[t._v("购电侧主体共"+t._s(t.model.m_sale_cp_num+t.model.m_ele_user_num)+"家")]),t._v(" "),a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleReady(2)}}},[t._v("\n              已准备\n            ")])],1),t._v(" "),a("h4",[a("span",{staticStyle:{color:"Lime"}},[t._v("已加入"+t._s(t.req_robots)+"个机器人，已进入"+t._s(t.req_in)+"家，")]),a("span",{staticStyle:{color:"Tomato"}},[t._v("还有"+t._s(t.model.m_sale_cp_num+t.model.m_ele_user_num-t.req_in-t.req_robots)+"家未进入")])]),t._v(" "),a("Card",[a("transition-group",{attrs:{name:"suplist",tag:"p"}},t._l(t.reqlogitems,function(e,s){return a("div",{key:s,staticClass:"list-item"},[t._v("\n                "+t._s(e.content)+"\n              ")])}))],1)],1)],1)],1)],1):"进行中"==t.model.status?a("div",[a("Row",[a("Col",{attrs:{span:12}},[a("Card",[a("h3",{attrs:{slot:"title"},slot:"title"},[t._v("发电侧主体共"+t._s(t.model.m_pro_cp_num)+"家")]),t._v(" "),a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleViewApply(1)}}},[t._v("\n              已申报\n            ")]),t._v(" "),a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleViewApply(2)}}},[t._v("\n              未申报\n            ")])],1),t._v(" "),a("h4",[a("span",{staticStyle:{color:"Lime"}},[t._v("已加入"+t._s(t.sup_robots)+"个机器人，已申报"+t._s(t.sup_commit_list.length)+"家，")]),a("span",{staticStyle:{color:"Tomato"}},[t._v("还有"+t._s(t.sup_uncommit_list.length)+"家未申报")])]),t._v(" "),a("Progress",{attrs:{percent:t.sup_process,"stroke-width":16,"text-inside":""}}),t._v(" "),a("Card",[a("transition-group",{attrs:{name:"suplist",tag:"p"}},t._l(t.suplogitems,function(e,s){return a("div",{key:s,staticClass:"list-item"},[t._v("\n                "+t._s(e.content)+"\n              ")])}))],1)],1)],1),t._v(" "),a("Col",{attrs:{span:12}},[a("Card",[a("h3",{attrs:{slot:"title"},slot:"title"},[t._v("购电侧主体共"+t._s(t.model.m_sale_cp_num+t.model.m_ele_user_num)+"家")]),t._v(" "),a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleViewApply(3)}}},[t._v("\n              已申报\n            ")]),t._v(" "),a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleViewApply(4)}}},[t._v("\n              未申报\n            ")])],1),t._v(" "),a("h4",[a("span",{staticStyle:{color:"Lime"}},[t._v("已加入"+t._s(t.req_robots)+"个机器人，已申报"+t._s(t.req_commit_list.length)+"家，")]),a("span",{staticStyle:{color:"Tomato"}},[t._v("还有"+t._s(t.req_uncommit_list.length)+"家未申报")])]),t._v(" "),a("Progress",{attrs:{percent:t.req_process,"stroke-width":16,"text-inside":""}}),t._v(" "),a("Card",[a("transition-group",{attrs:{name:"suplist",tag:"p"}},t._l(t.reqlogitems,function(e,s){return a("div",{key:s,staticClass:"list-item"},[t._v("\n                "+t._s(e.content)+"\n              ")])}))],1)],1)],1)],1)],1):"已结束"==t.model.status?a("div",[a("Row",[a("Col",{staticStyle:{padding:"2px"},attrs:{span:24}},[a("Card",{attrs:{bordered:!1}},[a("tran-bar",{staticStyle:{height:"300px"},attrs:{chartoption:t.all_option}})],1)],1),t._v(" "),t.model.m_result.group_data?a("div",t._l(t.single_option,function(e,s){return a("Col",{key:s,staticStyle:{padding:"2px"},attrs:{span:12}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("时段:"+t._s(e.name))]),t._v(" "),"已结束"==t.model.status?a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleCommit(2,s,2)}}},[t._v("\n                申报数据\n              ")]),t._v(" "),a("Button",{attrs:{size:"small"},on:{click:function(e){e.preventDefault(),t.handleCommit(2,s,1)}}},[t._v("\n                出清结果\n              ")])],1):t._e(),t._v(" "),a("tran-bar",{staticStyle:{height:"300px"},attrs:{chartoption:e.option,text:"出清结果"}})],1)],1)})):t._e()],1)],1):t._e()],1),t._v(" "),a("privatemodel",{attrs:{title:t.modaltitle,interval:t.interval,datatype:t.datatype}}),t._v(" "),a("public-modal",{attrs:{title:"需求方已加入市场主体",nofooter:!0,width:"500"},model:{value:t.req_ready_modal_show,callback:function(e){t.req_ready_modal_show=e},expression:"req_ready_modal_show"}},t._l(t.req_in_list,function(e,s){return a("Card",{key:s},[t._v("\n      "+t._s(e)+"\n      "),a("Icon",{staticStyle:{float:"right"},attrs:{type:"ios-checkmark-circle",color:"LimeGreen",size:"20"}})],1)})),t._v(" "),a("public-modal",{attrs:{title:"供给方已加入市场主体",nofooter:!0,width:"500"},model:{value:t.sup_ready_modal_show,callback:function(e){t.sup_ready_modal_show=e},expression:"sup_ready_modal_show"}},t._l(t.sup_in_list,function(e,s){return a("Card",{key:s},[t._v("\n      "+t._s(e)+"\n      "),a("Icon",{staticStyle:{float:"right"},attrs:{type:"ios-checkmark-circle",color:"LimeGreen",size:"20"}})],1)})),t._v(" "),a("public-modal",{attrs:{title:"新加机器人",width:"1000"},on:{"on-ok":function(e){t.handleCommitRobot()},"on-cancel":function(e){t.handleReset()}},model:{value:t.m_sup_robot_show,callback:function(e){t.m_sup_robot_show=e},expression:"m_sup_robot_show"}},[a("robot",{model:{value:t.ori_m_sup_robot,callback:function(e){t.ori_m_sup_robot=e},expression:"ori_m_sup_robot"}})],1),t._v(" "),a("public-modal",{attrs:{title:"申报情况",nofooter:!0,width:"500"},model:{value:t.apply_modal_show,callback:function(e){t.apply_modal_show=e},expression:"apply_modal_show"}},[1==t.apply_type?a("div",t._l(t.sup_commit_list,function(e,s){return a("Card",{key:s},[t._v("\n        "+t._s(e.create_user)+"\n        "),a("Icon",{staticStyle:{float:"right"},attrs:{type:"ios-checkmark-circle",color:"LimeGreen",size:"20"}})],1)})):2==t.apply_type?a("div",t._l(t.sup_uncommit_list,function(e,s){return a("Card",{key:s},[t._v("\n        "+t._s(e.create_user)+"\n        "),a("Icon",{staticStyle:{float:"right"},attrs:{type:"ios-close-circle",color:"OrangeRed",size:"20"}})],1)})):3==t.apply_type?a("div",t._l(t.req_commit_list,function(e,s){return a("Card",{key:s},[t._v("\n        "+t._s(e.create_user)+"\n        "),a("Icon",{staticStyle:{float:"right"},attrs:{type:"ios-checkmark-circle",color:"LimeGreen",size:"20"}})],1)})):a("div",t._l(t.req_uncommit_list,function(e,s){return a("Card",{key:s},[t._v("\n        "+t._s(e.create_user)+"\n        "),a("Icon",{staticStyle:{float:"right"},attrs:{type:"ios-close-circle",color:"OrangeRed",size:"20"}})],1)}))])],1)},r=[],i=a("yT7P"),n=(a("f3/d"),a("L2JU")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("public-modal",{attrs:{title:t.title,nofooter:!0,width:"1000"},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("Tabs",{attrs:{type:"card"}},[t._l(t.show_tableData,function(e,s){return a("TabPane",{key:s,attrs:{label:1==t.datatype?e.name+"(Qe="+e.Qe+",Pe="+e.Pe+")":e.name}},[3==t.datatype?a("Row",[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("撮合数据")]),t._v(" "),a("tables",{ref:"deal_tables_"+s,refInFor:!0,attrs:{searchable:"",outaddable:!1,outeditable:!1,outviewable:!1,exporttitle:"导出",searchinputstyle:t.searchinputstyle,searchkeystyle:t.searchkeystyle,"highlight-row":"",columns:t.columns},model:{value:e.data,callback:function(a){t.$set(e,"data",a)},expression:"item.data"}})],1)],1):a("Row",[a("i-col",{attrs:{span:12}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("需求方")]),t._v(" "),a("tables",{ref:"reqtables_"+s,refInFor:!0,attrs:{searchable:"",outaddable:!1,outeditable:!1,outviewable:!1,exporttitle:"导出",searchinputstyle:t.searchinputstyle,searchkeystyle:t.searchkeystyle,"highlight-row":"",columns:t.columns},model:{value:e.req,callback:function(a){t.$set(e,"req",a)},expression:"item.req"}})],1)],1),t._v(" "),a("i-col",{attrs:{span:12}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("供给方")]),t._v(" "),a("tables",{ref:"suptables_"+s,refInFor:!0,attrs:{searchable:"",outaddable:!1,outeditable:!1,outviewable:!1,exporttitle:"导出",searchinputstyle:t.searchinputstyle,searchkeystyle:t.searchkeystyle,"highlight-row":"",columns:t.columns},model:{value:e.sup,callback:function(a){t.$set(e,"sup",a)},expression:"item.sup"}})],1)],1)],1)],1)}),t._v(" "),a("ButtonGroup",{attrs:{slot:"extra"},slot:"extra"},[1!=t.datatype||t.istongji?t._e():a("Button",{attrs:{size:"small"},on:{click:t.handleShowTongji}},[t._v("统计")]),t._v(" "),1==t.datatype&&t.istongji?a("Button",{attrs:{size:"small"},on:{click:t.handleShowOrigin}},[t._v("原始")]):t._e(),t._v(" "),3!=t.datatype?a("Button",{attrs:{size:"small",loading:t.exportLoading},on:{click:t.handleExportAll}},[t._v("导出全部")]):t._e()],1)],2)],1)],1)},l=[],_=(a("9/nm"),a("ULSL")),u=a("wnYN"),d=a("+mnW"),m={name:"Privatemodel",components:{publicModal:_["a"],Tables:d["a"]},props:{title:{type:String,default:function(){return""}},datatype:{type:Number,default:function(){return 1}},interval:{type:Number,default:function(){return-1}}},data:function(){return{imodel:{name:"",status:"未开始",begin_date:"",plan_end_date:"",end_date:"",bidding_type:"",clear_type:"",ispublic:"",tran_type:"",trun_interval:{},m_sale_cp_num:0,m_ele_user_num:0,m_pro_cp_num:0,m_robot:{},m_sup_robot:{},m_sale_cp_real:[],m_ele_user_real:[],m_pro_cp_real:[],m_result:{},p_clear_type:"",p_clear_ratio:50},exportLoading:!1,istongji:!1,searchinputstyle:{width:"100px"},searchkeystyle:{width:"100px"}}},computed:{model:{get:function(){return this.imodel=Object(u["c"])(this.$store.state.mtransaction.mtransaction_edit_obj),this.imodel},set:function(t){this.$store.state.mtransaction.mtransaction_edit_obj=t}},showModal:{get:function(){return this.$store.state.mtransaction.mtransaction_result_show},set:function(t){this.$store.state.mtransaction.mtransaction_result_show=t}},columns:{get:function(){return 1==this.datatype?this.istongji?[{title:"名称",key:"uname",type:"String",sortable:!0,resizable:!0},{title:"电量",key:"q",type:"Number",sortable:!0,resizable:!0},{title:"申报电价",key:"p",type:"Number",sortable:!0,resizable:!0},{title:"成交电量",key:"q_deal",type:"Number",sortable:!0,resizable:!0}]:[{title:"名称",key:"uname",type:"String",sortable:!0,resizable:!0},{title:"电量",key:"q",type:"Number",sortable:!0,resizable:!0},{title:"申报电价",key:"p",type:"Number",sortable:!0,resizable:!0},{title:"成交电价",key:"p_deal",type:"String",sortable:!0,resizable:!0}]:2==this.datatype?[{title:"名称",key:"uname",type:"String",sortable:!0,resizable:!0},{title:"电量",key:"q",type:"Number",sortable:!0,resizable:!0},{title:"申报电价",key:"p",type:"Number",sortable:!0,resizable:!0},{title:"提交时间",key:"d",type:"String",sortable:!0,resizable:!0}]:3==this.datatype?[{title:"发电方",key:"user_sup",type:"String",sortable:!0,resizable:!0},{title:"发电报价",key:"p_sup",type:"Number",sortable:!0,resizable:!0},{title:"购电方",key:"user_req",type:"String",sortable:!0,resizable:!0},{title:"购电报价",key:"p_req",type:"Number",sortable:!0,resizable:!0},{title:"成交电量",key:"q",type:"Number",sortable:!0,resizable:!0}]:void 0}},mmiddleData:{get:function(){return this.$store.state.mmiddle.mmiddle_list}},show_tableData:{get:function(){var t=[],e=this.$store.state.buuser.buuser_list;if(-1==this.interval){if(1==this.datatype)this.model.m_result.trans_data&&(this.istongji?(t=Object(u["c"])(this.model.m_result.trans_data),t.forEach(function(t){t.req=Object(u["l"])(t.req,function(t){return["uid"+t.uid+"=p"+t.p]},function(t){var e=[];return t.forEach(function(t){var a=Object(u["c"])(t[0]);a.q=0,a.q_deal=0,t.forEach(function(t){a.q=a.q+t.q,null!=t.p_deal&&(a.q_deal=a.q_deal+t.q)}),e.push(a)}),e}),t.sup=Object(u["l"])(t.sup,function(t){return["uid"+t.uid+"=p"+t.p]},function(t){var e=[];return t.forEach(function(t){var a=Object(u["c"])(t[0]);a.q=0,a.q_deal=0,t.forEach(function(t){a.q=a.q+t.q,null!=t.p_deal&&(a.q_deal=a.q_deal+t.q)}),e.push(a)}),e})})):t=Object(u["c"])(this.model.m_result.trans_data));else if(2==this.datatype){if(this.model.m_result.origin_data)for(var a=0;a<this.model.m_result.origin_data.req.length;a++)t.push({name:this.model.m_result.origin_data.req[a].name,iid:this.model.m_result.origin_data.req[a].iid,req:this.model.m_result.origin_data.req[a].data,sup:this.model.m_result.origin_data.sup[a].data})}else if(3==this.datatype)return t=this.mmiddleData.map(function(t){return t.data=t.data.map(function(t){return t.user_sup=t.sup.uid.map(function(t){var a=e.filter(function(e){return e.id==t})[0];return a?a.realname:t}).join(","),t.p_sup=t.sup.p,t.user_req=t.req.uid.map(function(t){var a=e.filter(function(e){return e.id==t})[0];return a?a.realname:t}).join(","),t.p_req=t.req.p,t.q=t.req.q,t}),t}),t}else 1==this.datatype?this.model.m_result.trans_data&&(this.istongji?(t=[Object(u["c"])(this.model.m_result.trans_data[this.interval])],t.forEach(function(t){t.req=Object(u["l"])(t.req,function(t){return["uid"+t.uid+"=p"+t.p]},function(t){var e=[];return t.forEach(function(t){var a=Object(u["c"])(t[0]);a.q=0,a.q_deal=0,t.forEach(function(t){a.q=a.q+t.q,null!=t.p_deal&&(a.q_deal=a.q_deal+t.q)}),e.push(a)}),e}),t.sup=Object(u["l"])(t.sup,function(t){return["uid"+t.uid+"=p"+t.p]},function(t){var e=[];return t.forEach(function(t){var a=Object(u["c"])(t[0]);a.q=0,a.q_deal=0,t.forEach(function(t){a.q=a.q+t.q,null!=t.p_deal&&(a.q_deal=a.q_deal+t.q)}),e.push(a)}),e})})):t=[Object(u["c"])(this.model.m_result.trans_data[this.interval])]):2==this.datatype&&this.model.m_result.origin_data&&t.push({name:this.model.m_result.origin_data.req[this.interval].name,iid:this.model.m_result.origin_data.req[this.interval].iid,req:this.model.m_result.origin_data.req[this.interval].data,sup:this.model.m_result.origin_data.sup[this.interval].data});return t.forEach(function(t){t.req.forEach(function(t){var a=e.filter(function(e){return e.id==t.uid})[0];t.uname=a?a.realname:t.uid}),t.sup.forEach(function(t){var a=e.filter(function(e){return e.id==t.uid})[0];t.uname=a?a.realname:t.uid})}),t}}},methods:Object(i["a"])({},Object(n["b"])(["handleCreateMtransaction","handleUpdateMtransaction","handleGetBuuser"]),{handleShowTongji:function(){this.istongji=!0},handleShowOrigin:function(){this.istongji=!1},handleExportAll:function(){var t=this,e=[];1==this.datatype?this.istongji?(this.exportLoading=!0,this.show_tableData.forEach(function(t){e.push({req_name:"出清结果",req_q:"Qe="+t.Qe,req_p:"Pe="+t.Pe,req_q_deal:"",req_d:"",req_middle:"",sup_name:"",sup_q:"",sup_p:"",sup_q_deal:"",sup_d:""});for(var a=Math.max(t.req.length,t.sup.length),s=0;s<a;s++)e.push({req_name:t.req[s]?t.req[s].uname:"",req_q:t.req[s]?t.req[s].q:"",req_p:t.req[s]?t.req[s].p:"",req_q_deal:t.req[s]?t.req[s].q_deal:"",req_d:t.req[s]?t.req[s].d:"",req_middle:"",sup_name:t.sup[s]?t.sup[s].uname:"",sup_q:t.sup[s]?t.sup[s].q:"",sup_p:t.sup[s]?t.sup[s].p:"",sup_q_deal:t.sup[s]?t.sup[s].q_deal:"",sup_d:t.sup[s]?t.sup[s].d:""});e.push({req_name:"",req_q:"",req_p:"",req_q_deal:"",req_d:"",req_middle:"",sup_name:"",sup_q:"",sup_p:"",sup_q_deal:"",sup_d:""})}),Promise.all([a.e(33),a.e(34)]).then(a.bind(null,"CiGO")).then(function(a){var s={title:["需求方名称","电量","申报电价","成交电量","提交时间","","供应方名称","电量","申报电价","成交电量","提交时间"],key:["req_name","req_q","req_p","req_q_deal","req_d","req_middle","sup_name","sup_q","sup_p","sup_q_deal","sup_d"],data:e,autoWidth:!0,filename:t.title};a.export_array_to_excel(s),t.exportLoading=!1})):(this.exportLoading=!0,this.show_tableData.forEach(function(t){e.push({req_name:"出清结果",req_q:"Qe="+t.Qe,req_p:"Pe="+t.Pe,req_p_deal:"",req_d:"",req_middle:"",sup_name:"",sup_q:"",sup_p:"",sup_p_deal:"",sup_d:""});for(var a=Math.max(t.req.length,t.sup.length),s=0;s<a;s++)e.push({req_name:t.req[s]?t.req[s].uname:"",req_q:t.req[s]?t.req[s].q:"",req_p:t.req[s]?t.req[s].p:"",req_p_deal:t.req[s]?t.req[s].p_deal:"",req_d:t.req[s]?t.req[s].d:"",req_middle:"",sup_name:t.sup[s]?t.sup[s].uname:"",sup_q:t.sup[s]?t.sup[s].q:"",sup_p:t.sup[s]?t.sup[s].p:"",sup_p_deal:t.sup[s]?t.sup[s].p_deal:"",sup_d:t.sup[s]?t.sup[s].d:""});e.push({req_name:"",req_q:"",req_p:"",req_p_deal:"",req_d:"",req_middle:"",sup_name:"",sup_q:"",sup_p:"",sup_p_deal:"",sup_d:""})}),Promise.all([a.e(33),a.e(34)]).then(a.bind(null,"CiGO")).then(function(a){var s={title:["需求方名称","电量","申报电价","成交电价","提交时间","","供应方名称","电量","申报电价","成交电价","提交时间"],key:["req_name","req_q","req_p","req_p_deal","req_d","req_middle","sup_name","sup_q","sup_p","sup_p_deal","sup_d"],data:e,autoWidth:!0,filename:t.title};a.export_array_to_excel(s),t.exportLoading=!1})):(this.exportLoading=!0,this.show_tableData.forEach(function(t){for(var a=Math.max(t.req.length,t.sup.length),s=0;s<a;s++)e.push({req_name:t.req[s]?t.req[s].uname:"",req_q:t.req[s]?t.req[s].q:"",req_p:t.req[s]?t.req[s].p:"",req_d:t.req[s]?t.req[s].d:"",req_middle:"",sup_name:t.sup[s]?t.sup[s].uname:"",sup_q:t.sup[s]?t.sup[s].q:"",sup_p:t.sup[s]?t.sup[s].p:"",sup_d:t.sup[s]?t.sup[s].d:""});e.push({req_name:"",req_q:"",req_p:"",req_d:"",req_middle:"",sup_name:"",sup_q:"",sup_p:"",sup_d:""})}),Promise.all([a.e(33),a.e(34)]).then(a.bind(null,"CiGO")).then(function(a){var s={title:["需求方名称","申报电量","申报电价","提交时间","","供应方名称","申报电量","申报电价","提交时间"],key:["req_name","req_q","req_p","req_d","req_middle","sup_name","sup_q","sup_p","sup_d"],data:e,autoWidth:!0,filename:t.title};a.export_array_to_excel(s),t.exportLoading=!1}))}}),mounted:function(){},created:function(){}},p=m,c=(a("7EZI"),a("KHd+")),h=Object(c["a"])(p,o,l,!1,null,null,null),f=h.exports,y=a("nzdr"),q=a("ya4+"),b={name:"Mtranresults",components:{tranBar:q["c"],Privatemodel:f,publicModal:_["a"],robot:y["a"]},data:function(){return{imodel:{name:"",status:"未开始",begin_date:"",plan_end_date:"",end_date:"",bidding_type:"",clear_type:"",ispublic:"",tran_type:"",trun_interval:{},m_sale_cp_num:0,m_ele_user_num:0,m_pro_cp_num:0,m_robot:{},m_sup_robot:{},m_sale_cp_real:[],m_ele_user_real:[],m_pro_cp_real:[],m_result:{},p_clear_type:"",p_clear_ratio:50},collapsevalue:"",modaltitle:"数据视图",interval:-1,datatype:0,suplogitems:[],reqlogitems:[],maxdate:"",sup_in:0,req_in:0,sup_robots:0,req_robots:0,sup_in_list:[],req_in_list:[],sup_ready_modal_show:!1,req_ready_modal_show:!1,timer:null,m_sup_robot_show:!1,ori_m_sup_robot:[],sup_commit_list:[],sup_uncommit_list:[],req_commit_list:[],req_uncommit_list:[],apply_modal_show:!1,apply_type:1}},computed:{model:{get:function(){var t=this;return this.imodel=Object(u["c"])(this.$store.state.mtransaction.mtransaction_edit_obj),this.imodel.id?(this.ori_m_sup_robot=Object(u["c"])(this.imodel.m_sup_robot.robots),this.sup_in=this.imodel.m_pro_cp_real.length,this.req_in=this.imodel.m_sale_cp_real.length+this.imodel.m_ele_user_real.length,this.sup_in_list=this.imodel.m_pro_cp_real.map(function(e){var a=t.$store.state.buuser.buuser_list.filter(function(t){return t.id==e})[0];return a?a.realname:e}),this.req_in_list=this.imodel.m_sale_cp_real.map(function(e){var a=t.$store.state.buuser.buuser_list.filter(function(t){return t.id==e})[0];return a?a.realname:e}),this.req_in_list=this.req_in_list.concat(this.imodel.m_ele_user_real.map(function(e){var a=t.$store.state.buuser.buuser_list.filter(function(t){return t.id==e})[0];return a?a.realname:e})),this.sup_robots=0,this.req_robots=0,this.imodel.m_robot.robots&&this.imodel.m_robot.robots.forEach(function(e){"发电企业"==e.rtype?t.sup_robots=t.sup_robots+e.num:t.req_robots=t.req_robots+e.num}),this.imodel.m_sup_robot.robots&&this.imodel.m_sup_robot.robots.forEach(function(e){"发电企业"==e.rtype?t.sup_robots=t.sup_robots+e.num:t.req_robots=t.req_robots+e.num})):this.$router.push("m-transaction"),this.imodel},set:function(t){this.imodel=t}},all_option:{get:function(){var t=this;if(this.model.m_result.trans_data){var e={title:{text:"交易出清汇总",subtext:"",x:"left"},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}}},dataZoom:[{show:!0,realtime:!0,start:0,end:100},{type:"inside",realtime:!0,start:0,end:100}],legend:{data:["电量","电价"]},xAxis:[{type:"category",data:[],axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"电量",min:0,axisLabel:{formatter:"{value} kWh"}},{type:"value",name:"电价",axisLabel:{formatter:"{value}"}}],series:[{name:"电量",type:"bar",label:{position:"inside",show:!0,formatter:function(t){return t.name}},barCategoryGap:"-2%",data:[],itemStyle:{normal:{color:function(t){var e=["#2b85e4","#91c7ae","#d48265","#FFFF99","#FF9933","#61a0a8","#6666FF","#dc143c","#CCCC66","#2f4554","#333333","#999966","#9933FF","#663366","#99CC99","#749f83","#ca8622","#CCCC00","#999999","#993399","#993333","#336699","#FFCC00","#669999","#003366","#999933"];return t.data&&(-1==t.data.index||t.data.index>=e.length)?"#2b85e4":e[t.data.index]}}}},{name:"电价",type:"line",smooth:!1,yAxisIndex:1,data:[]}]};return this.model.m_result.trans_data.forEach(function(a){var s=t.model.trun_interval.interval.filter(function(t){return t.id==a.id})[0];if(s)for(var r=s.begin,i=s.end,n=r;n<=i;n++)e.xAxis[0].data.push(n),e.series[0].data.push({value:a.Qe,name:a.name,index:t.model_interval_list.indexOf(a.name)}),e.series[1].data.push(a.Pe);else e.xAxis[0].data.push(a.name),e.series[0].data.push(a.Qe),e.series[1].data.push(a.Pe)}),e}return{title:{text:"出清结果",subtext:"",x:"left"},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:[]},xAxis:[{type:"category",data:[],axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"电量",axisLabel:{formatter:"{value} KWH"}},{type:"value",name:"电价",axisLabel:{formatter:"{value} 元"}}],series:[{name:"电量",type:"bar",data:[]},{name:"电价",type:"line",yAxisIndex:1,data:[]}]}}},single_option:{get:function(){var t=this;if(this.model.m_result.group_data){for(var e=[],a=this.model.m_result.trans_data||[],s=function(s){var r={title:{text:"出清图",subtext:"",x:"left"},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}},formatter:" {a0}曲线:(电量,电价)=>{c0}<br /> {a1}曲线:(电量,电价)=>{c1}"},toolbox:{feature:{mark:{show:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:["需求","供给"]},dataZoom:[{show:!0,realtime:!0,start:0,end:100},{type:"inside",realtime:!0,start:0,end:100}],calculable:!0,xAxis:[{type:"value"}],yAxis:[{type:"value",axisLine:{lineStyle:{color:"#dc143c"}}}],series:[{name:"需求",type:"line",smooth:!1,data:[]},{name:"供给",type:"line",smooth:!1,data:[]}]},i={name:t.model.m_result.group_data.req[s].name,option:r},n=[],o=0,l=0;t.model.m_result.group_data.req[s].data.forEach(function(t){l=t.p,n.push([o,l]),o+=t.q,n.push([o,l])});var _=[];o=0,l=0,t.model.m_result.group_data.sup[s].data.forEach(function(t){l=t.p,_.push([o,l]),o+=t.q,_.push([o,l])}),r.series[0].data=n,r.series[1].data=_;var u=a.filter(function(e){return e.id==t.model.m_result.group_data.req[s].iid})[0];u&&(r.series[0].markLine={data:[{name:"Pe",yAxis:u.Pe,lineStyle:{color:"#dc143c"}},{name:"Qe",xAxis:u.Qe,lineStyle:{color:"#dc143c"}}]},r.series[0].markPoint={data:[{name:"出清点",coord:[u.Qe,u.Pe],symbol:"emptyCircle",symbolSize:12,itemStyle:{normal:{color:"#dc143c",label:{position:"top"}}}}]}),e.push(i)},r=0;r<this.model.m_result.group_data.req.length;r++)s(r);return e}return[]}},model_interval_list:{get:function(){return this.model.trun_interval&&this.model.trun_interval.interval?this.model.trun_interval.interval.map(function(t){return t.name}):[]}},sup_process:{get:function(){return this.sup_commit_list.length+this.sup_uncommit_list.length==0?0:this.sup_commit_list.length/(this.sup_commit_list.length+this.sup_uncommit_list.length)*100}},req_process:{get:function(){return this.req_commit_list.length+this.req_uncommit_list.length==0?0:this.req_commit_list.length/(this.req_commit_list.length+this.req_uncommit_list.length)*100}}},methods:Object(i["a"])({},Object(n["b"])(["handleCreateMtransaction","handleUpdateMtransaction","handleGetMtransactionById","handleGetLogtransaction","handleGetBuuser","handleGetMbiddingByTranId","handleGetMmiddle"]),{handleCommit:function(t,e,a){var s=this;if(0==t?("date"==Object(u["s"])(this.model.begin_date)&&(this.model.begin_date=this.model.begin_date.Format("yyyy-MM-dd hh:mm:ss")),"date"==Object(u["s"])(this.model.plan_end_date)&&(this.model.plan_end_date=this.model.plan_end_date.Format("yyyy-MM-dd hh:mm:ss")),this.model.trun_interval.interval.forEach(function(t){t.p_cata=t.p_online+t.p_tran+t.p_gov}),this.model.status="进行中",this.maxdate="",this.$store.dispatch("handleUpdateMtransaction",{form:this.model}).then(function(t){s.loadData(),s.$Message.success("Success!")}).catch(function(t){s.$Message.error(t)})):1==t&&("date"==Object(u["s"])(this.model.begin_date)&&(this.model.begin_date=this.model.begin_date.Format("yyyy-MM-dd hh:mm:ss")),"date"==Object(u["s"])(this.model.plan_end_date)&&(this.model.plan_end_date=this.model.plan_end_date.Format("yyyy-MM-dd hh:mm:ss")),this.model.trun_interval.interval.forEach(function(t){t.p_cata=t.p_online+t.p_tran+t.p_gov}),this.model.status="已结束",this.$store.dispatch("handleUpdateMtransaction",{form:this.model}).then(function(t){s.loadData(),s.$Message.success("Success!")}).catch(function(t){s.$Message.error(t)})),2==t){if(this.interval=e,this.datatype=a,1==this.datatype)this.modaltitle="出清数据视图";else if(2==this.datatype)this.modaltitle="申报数据视图";else{var r={offset:0,limit:1,orderby:{},filterby:{tran_id:this.model.id,datatype:"撮合输出"}};this.loading=!0,this.$store.dispatch("handleGetMmiddle",{form:r}).then(function(t){s.loading=!1}),this.modaltitle="撮合数据视图"}this.$store.state.mtransaction.mtransaction_result_show=!0}},handleCommitRobot:function(){var t=this;"date"==Object(u["s"])(this.imodel.begin_date)&&(this.imodel.begin_date=this.imodel.begin_date.Format("yyyy-MM-dd hh:mm:ss")),"date"==Object(u["s"])(this.imodel.plan_end_date)&&(this.imodel.plan_end_date=this.imodel.plan_end_date.Format("yyyy-MM-dd hh:mm:ss")),this.imodel.trun_interval.interval.forEach(function(t){t.p_cata=t.p_online+t.p_tran+t.p_gov}),this.imodel.m_sup_robot.robots=this.ori_m_sup_robot,this.$store.dispatch("handleUpdateMtransaction",{form:this.imodel}).then(function(e){t.$Message.success("Success!")}).catch(function(e){t.$Message.error(e)})},handleReset:function(){this.ori_m_sup_robot=Object(u["c"])(this.imodel.m_sup_robot.robots)},handleReady:function(t){1==t?this.sup_ready_modal_show=!0:this.req_ready_modal_show=!0},handleViewApply:function(t){this.apply_type=t,this.apply_modal_show=!0},handleAddSupRobot:function(t){this.m_sup_robot_show=!0},loadData:function(){var t=this;"未开始"==this.model.status?this.timer=setInterval(function(){t.$store.dispatch("handleGetMtransactionById",{form:{id:t.model.id}}).then(function(t){}),t.$store.dispatch("handleGetLogtransaction",{form:{tranid:t.model.id,logtype:"0",maxdate:t.maxdate}}).then(function(e){200==e.code&&e.data.data.forEach(function(e){"sup"==e.biddingtype?t.suplogitems.unshift(e):t.reqlogitems.unshift(e),t.maxdate=e.create_date})})},5e3):"进行中"==this.model.status?(this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){t.$store.dispatch("handleGetMbiddingByTranId",{form:{tranid:t.model.id}}).then(function(e){200==e.code&&(t.sup_commit_list=e.data.data.filter(function(t){return"发电企业"==t.role&&t.iscommit}),t.sup_uncommit_list=e.data.data.filter(function(t){return"发电企业"==t.role&&!t.iscommit}),t.req_commit_list=e.data.data.filter(function(t){return"发电企业"!=t.role&&t.iscommit}),t.req_uncommit_list=e.data.data.filter(function(t){return"发电企业"!=t.role&&!t.iscommit}))}),t.$store.dispatch("handleGetLogtransaction",{form:{tranid:t.model.id,logtype:"1",maxdate:t.maxdate}}).then(function(e){200==e.code&&e.data.data.forEach(function(e){"sup"==e.biddingtype?t.suplogitems.unshift(e):t.reqlogitems.unshift(e),t.maxdate=e.create_date})})},5e3)):this.timer&&clearInterval(this.timer)}}),mounted:function(){this.$store.dispatch("handleGetBuuser",{form:{}}).then(function(t){}),this.loadData()},created:function(){},beforeDestroy:function(){this.timer&&clearInterval(this.timer)}},v=b,g=(a("NI1S"),Object(c["a"])(v,s,r,!1,null,null,null)),x=g.exports;e["default"]=x}}]);